<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>mpnsservice.js - Documentation</title>
    <meta name="viewport" content="initial-scale=.75">
    <script src="../../scripts/prettify/prettify.js"></script>
    <script src="../../scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="../../styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="../../styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><span><a href="../../index.html">Home</a> <span class="github-short">| <a href="https://github.com/azure/azure-sdk-for-node.git">GitHub</a></span></span></h2><h3>Classes</h3><ul><li><a href="ApnsService.html">ApnsService</a><ul class='methods'><li data-type='method'><a href="ApnsService.html#createNativeRegistration">createNativeRegistration</a></li><li data-type='method'><a href="ApnsService.html#createOrUpdateNativeRegistration">createOrUpdateNativeRegistration</a></li><li data-type='method'><a href="ApnsService.html#createOrUpdateTemplateRegistration">createOrUpdateTemplateRegistration</a></li><li data-type='method'><a href="ApnsService.html#createTemplateRegistration">createTemplateRegistration</a></li><li data-type='method'><a href="ApnsService.html#listRegistrationsByToken">listRegistrationsByToken</a></li><li data-type='method'><a href="ApnsService.html#send">send</a></li><li data-type='method'><a href="ApnsService.html#updateTemplateRegistration">updateTemplateRegistration</a></li></ul></li><li><a href="GcmService.html">GcmService</a><ul class='methods'><li data-type='method'><a href="GcmService.html#createNativeRegistration">createNativeRegistration</a></li><li data-type='method'><a href="GcmService.html#createOrUpdateNativeRegistration">createOrUpdateNativeRegistration</a></li><li data-type='method'><a href="GcmService.html#createOrUpdateTemplateRegistration">createOrUpdateTemplateRegistration</a></li><li data-type='method'><a href="GcmService.html#createTemplateRegistration">createTemplateRegistration</a></li><li data-type='method'><a href="GcmService.html#listRegistrationsByGcmRegistrationId">listRegistrationsByGcmRegistrationId</a></li><li data-type='method'><a href="GcmService.html#send">send</a></li><li data-type='method'><a href="GcmService.html#updateTemplateRegistration">updateTemplateRegistration</a></li></ul></li><li><a href="MpnsService.html">MpnsService</a><ul class='methods'><li data-type='method'><a href="MpnsService.html#createFlipTileRegistration">createFlipTileRegistration</a></li><li data-type='method'><a href="MpnsService.html#createNativeRegistration">createNativeRegistration</a></li><li data-type='method'><a href="MpnsService.html#createOrUpdateNativeRegistration">createOrUpdateNativeRegistration</a></li><li data-type='method'><a href="MpnsService.html#createOrUpdateRawTemplateRegistration">createOrUpdateRawTemplateRegistration</a></li><li data-type='method'><a href="MpnsService.html#createRawTemplateRegistration">createRawTemplateRegistration</a></li><li data-type='method'><a href="MpnsService.html#createTileRegistration">createTileRegistration</a></li><li data-type='method'><a href="MpnsService.html#createToastRegistration">createToastRegistration</a></li><li data-type='method'><a href="MpnsService.html#listRegistrationsByChannel">listRegistrationsByChannel</a></li><li data-type='method'><a href="MpnsService.html#send">send</a></li><li data-type='method'><a href="MpnsService.html#sendFlipTile">sendFlipTile</a></li><li data-type='method'><a href="MpnsService.html#sendTile">sendTile</a></li><li data-type='method'><a href="MpnsService.html#sendToast">sendToast</a></li><li data-type='method'><a href="MpnsService.html#updateFlipTileRegistration">updateFlipTileRegistration</a></li><li data-type='method'><a href="MpnsService.html#updatesRawTemplateRegistration">updatesRawTemplateRegistration</a></li><li data-type='method'><a href="MpnsService.html#updatesToastRegistration">updatesToastRegistration</a></li><li data-type='method'><a href="MpnsService.html#updateTileRegistration">updateTileRegistration</a></li></ul></li><li><a href="NotificationHubService.html">NotificationHubService</a><ul class='methods'><li data-type='method'><a href="NotificationHubService.html#createOrUpdateInstallation">createOrUpdateInstallation</a></li><li data-type='method'><a href="NotificationHubService.html#createOrUpdateRegistration">createOrUpdateRegistration</a></li><li data-type='method'><a href="NotificationHubService.html#createRegistrationId">createRegistrationId</a></li><li data-type='method'><a href="NotificationHubService.html#deleteInstallation">deleteInstallation</a></li><li data-type='method'><a href="NotificationHubService.html#deleteRegistration">deleteRegistration</a></li><li data-type='method'><a href="NotificationHubService.html#getInstallation">getInstallation</a></li><li data-type='method'><a href="NotificationHubService.html#getRegistration">getRegistration</a></li><li data-type='method'><a href="NotificationHubService.html#listRegistrations">listRegistrations</a></li><li data-type='method'><a href="NotificationHubService.html#listRegistrationsByTag">listRegistrationsByTag</a></li><li data-type='method'><a href="NotificationHubService.html#patchInstallation">patchInstallation</a></li><li data-type='method'><a href="NotificationHubService.html#send">send</a></li><li data-type='method'><a href="NotificationHubService.html#updateRegistration">updateRegistration</a></li></ul></li><li><a href="ServiceBusService.html">ServiceBusService</a><ul class='methods'><li data-type='method'><a href="ServiceBusService.html#createNotificationHub">createNotificationHub</a></li><li data-type='method'><a href="ServiceBusService.html#createQueue">createQueue</a></li><li data-type='method'><a href="ServiceBusService.html#createQueueIfNotExists">createQueueIfNotExists</a></li><li data-type='method'><a href="ServiceBusService.html#createRule">createRule</a></li><li data-type='method'><a href="ServiceBusService.html#createSubscription">createSubscription</a></li><li data-type='method'><a href="ServiceBusService.html#createTopic">createTopic</a></li><li data-type='method'><a href="ServiceBusService.html#createTopicIfNotExists">createTopicIfNotExists</a></li><li data-type='method'><a href="ServiceBusService.html#deleteMessage">deleteMessage</a></li><li data-type='method'><a href="ServiceBusService.html#deleteNotificationHub">deleteNotificationHub</a></li><li data-type='method'><a href="ServiceBusService.html#deleteQueue">deleteQueue</a></li><li data-type='method'><a href="ServiceBusService.html#deleteRule">deleteRule</a></li><li data-type='method'><a href="ServiceBusService.html#deleteSubscription">deleteSubscription</a></li><li data-type='method'><a href="ServiceBusService.html#deleteTopic">deleteTopic</a></li><li data-type='method'><a href="ServiceBusService.html#getNotificationHub">getNotificationHub</a></li><li data-type='method'><a href="ServiceBusService.html#getQueue">getQueue</a></li><li data-type='method'><a href="ServiceBusService.html#getRule">getRule</a></li><li data-type='method'><a href="ServiceBusService.html#getSubscription">getSubscription</a></li><li data-type='method'><a href="ServiceBusService.html#getTopic">getTopic</a></li><li data-type='method'><a href="ServiceBusService.html#listNotificationHubs">listNotificationHubs</a></li><li data-type='method'><a href="ServiceBusService.html#listQueues">listQueues</a></li><li data-type='method'><a href="ServiceBusService.html#listRules">listRules</a></li><li data-type='method'><a href="ServiceBusService.html#listSubscriptions">listSubscriptions</a></li><li data-type='method'><a href="ServiceBusService.html#listTopics">listTopics</a></li><li data-type='method'><a href="ServiceBusService.html#receiveQueueMessage">receiveQueueMessage</a></li><li data-type='method'><a href="ServiceBusService.html#receiveSubscriptionMessage">receiveSubscriptionMessage</a></li><li data-type='method'><a href="ServiceBusService.html#renewLockForMessage">renewLockForMessage</a></li><li data-type='method'><a href="ServiceBusService.html#sendQueueMessage">sendQueueMessage</a></li><li data-type='method'><a href="ServiceBusService.html#sendTopicMessage">sendTopicMessage</a></li><li data-type='method'><a href="ServiceBusService.html#unlockMessage">unlockMessage</a></li></ul></li><li><a href="ServiceBusServiceBase.html">ServiceBusServiceBase</a><ul class='methods'><li data-type='method'><a href="ServiceBusServiceBase.html#_createResource">_createResource</a></li><li data-type='method'><a href="ServiceBusServiceBase.html#_deleteResource">_deleteResource</a></li><li data-type='method'><a href="ServiceBusServiceBase.html#_executeRequest">_executeRequest</a></li><li data-type='method'><a href="ServiceBusServiceBase.html#_getResource">_getResource</a></li><li data-type='method'><a href="ServiceBusServiceBase.html#_listResources">_listResources</a></li></ul></li><li><a href="ServiceBusServiceClient.html">ServiceBusServiceClient</a><ul class='methods'><li data-type='method'><a href="ServiceBusServiceClient.html#_buildRequestOptions">_buildRequestOptions</a></li></ul></li><li><a href="SharedAccessSignature.html">SharedAccessSignature</a><ul class='methods'><li data-type='method'><a href="SharedAccessSignature.html#signRequest">signRequest</a></li></ul></li><li><a href="WnsService.html">WnsService</a><ul class='methods'><li data-type='method'><a href="WnsService.html#createNativeRegistration">createNativeRegistration</a></li><li data-type='method'><a href="WnsService.html#createOrUpdateNativeRegistration">createOrUpdateNativeRegistration</a></li><li data-type='method'><a href="WnsService.html#createOrUpdateRawTemplateRegistration">createOrUpdateRawTemplateRegistration</a></li><li data-type='method'><a href="WnsService.html#createRawTemplateRegistration">createRawTemplateRegistration</a></li><li data-type='method'><a href="WnsService.html#createTile*Registration">createTile*Registration</a></li><li data-type='method'><a href="WnsService.html#createToast*Registration">createToast*Registration</a></li><li data-type='method'><a href="WnsService.html#listRegistrationsByChannel">listRegistrationsByChannel</a></li><li data-type='method'><a href="WnsService.html#send">send</a></li><li data-type='method'><a href="WnsService.html#sendBadge">sendBadge</a></li><li data-type='method'><a href="WnsService.html#sendRaw">sendRaw</a></li><li data-type='method'><a href="WnsService.html#sendTile*">sendTile*</a></li><li data-type='method'><a href="WnsService.html#sendToast*">sendToast*</a></li><li data-type='method'><a href="WnsService.html#updatesRawTemplateRegistration">updatesRawTemplateRegistration</a></li><li data-type='method'><a href="WnsService.html#updateTile*Registration">updateTile*Registration</a></li><li data-type='method'><a href="WnsService.html#updateToast*Registration">updateToast*Registration</a></li></ul></li></ul><h3>Global</h3><ul><li><a href="global.html#createNotificationHubService">createNotificationHubService</a></li><li><a href="global.html#createServiceBusService">createServiceBusService</a></li><li><a href="global.html#createWrapService">createWrapService</a></li><li><a href="global.html#validateCallback">validateCallback</a></li><li><a href="global.html#Wrap">Wrap</a></li><li><a href="global.html#WrapService">WrapService</a></li><li><a href="global.html#WrapTokenManager">WrapTokenManager</a></li></ul>
</nav>

<div id="main">
    
      <a class="github-banner" href="https://github.com/azure/azure-sdk-for-node.git"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/38ef81f8aca64bb9a64448d0d70f1308ef5341ab/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6461726b626c75655f3132313632312e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"></a>
    
    
    <h1 class="page-title">mpnsservice.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>// 
// Copyright (c) Microsoft and contributors.  All rights reserved.
// 
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//   http://www.apache.org/licenses/LICENSE-2.0
// 
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// 
// See the License for the specific language governing permissions and
// limitations under the License.
// 

var util = require('util');

var _ = require('underscore');
var mpns = require('mpns');

var azureCommon = require('azure-common');
var azureutil = azureCommon.util;
var Constants = azureCommon.Constants;
var validate = azureCommon.validate;
var HeaderConstants = Constants.HeaderConstants;
var WebResource = azureCommon.WebResource;

var registrationResult = require('./models/registrationresult');

// White list of methods to use from wns module
var templateSpecs = [ 'Toast', 'Tile', 'FlipTile', 'Raw' ];

/**
* Creates a new MpnsService object.
*
* __Note__: An instance of this object is created automatically when a {@link NotificationHubService}
* object is created. See {@link NotificationHubService#gcm}.
* @class
* The MpnsService class is used to send notifications using the [Microsoft Push Notification Service](http://msdn.microsoft.com/en-us/library/windowsphone/develop/ff402558).
* @constructor
*
* @param {NotificationHubService} notificationHubService The notification hub service.
*/
function MpnsService(notificationHubService) {
  var self = this;

  this.notificationHubService = notificationHubService;

  var addSendMethod = function (createFunctionName, templateName) {
    var sendName = util.format('send%s', templateName);

    self[sendName] = function () {
      // signature is (tags, [payload, ]+, [options], callback)
      var tags = Array.prototype.shift.apply(arguments);

      // Get arguments without the final callback to build payload
      var args = Array.prototype.slice.call(arguments, 0, arguments.length - 1);

      var options = {};
      if (arguments.length >= 3 &amp;&amp; _.isObject(arguments[arguments.length - 2])) {
        options = arguments[arguments.length - 2];
      }

      var callback = arguments[arguments.length - 1];

      if (!_.isFunction(callback)) {
        throw new Error('The callback parameter must be the callback function.');
      }

      var subject = mpns[createFunctionName].apply(mpns, args);
      var payload = subject.getXmlPayload();
      self.send(tags, payload, subject.targetName, subject.notificationClass, options, callback);
    };
  };

  var addCreateAndUpdateRegistrationMethod = function (createRegistrationFunctionName, templateName) {
    function createRegistrationXml(rawArgs) {
      // signature is (channel, tags, [payload, ]+, [options], callback)
      var channel = Array.prototype.shift.apply(rawArgs);
      var tags = Array.prototype.shift.apply(rawArgs);

      // Get arguments without the final callback to build payload
      var args = Array.prototype.slice.call(rawArgs, 0, rawArgs.length - 1);

      var options = {};
      if (rawArgs.length >= 3 &amp;&amp; _.isObject(rawArgs[rawArgs.length - 2])) {
        options = rawArgs[rawArgs.length - 2];
      }

      var subject = mpns[createRegistrationFunctionName].apply(mpns, args);
      var payload = subject.getXmlPayload();

      if (!options) {
        options = {};
      }

      if (!options.headers) {
        options.headers = {};
      }

      options.headers['X-WindowsPhone-Target'] = subject.targetName;
      options.headers['X-NotificationClass'] = subject.notificationClass;

      return self._createTemplateBody(channel, tags, payload, options);
    }

    var createRegistrationName = util.format('create%sRegistration', templateName);
    self[createRegistrationName] = function () {
      var callback = arguments[arguments.length - 1];

      if (!_.isFunction(callback)) {
        throw new Error('The callback parameter must be the callback function.');
      }

      var registrationXml = createRegistrationXml(arguments);

      var webResource = WebResource.post(self.notificationHubService.hubName + '/registrations')
        .withHeader(HeaderConstants.CONTENT_TYPE, 'application/atom+xml;type=entry;charset=utf-8')
        .withHeader(HeaderConstants.CONTENT_LENGTH, Buffer.byteLength(registrationXml, 'utf8'));

      self.notificationHubService._executeRequest(webResource, registrationXml, registrationResult, null, callback);
    };

    var updateRegistrationName = util.format('update%sRegistration', templateName);
    self[updateRegistrationName] = function () {
      var registrationId = Array.prototype.shift.apply(arguments);
      var callback = arguments[arguments.length - 1];

      if (!_.isFunction(callback)) {
        throw new Error('The callback parameter must be the callback function.');
      }

      var options = {};
      if (arguments.length >= 3 &amp;&amp; _.isObject(arguments[arguments.length - 2])) {
        options = arguments[arguments.length - 2];
      }

      var registrationXml = createRegistrationXml(arguments);

      var webResource = WebResource.put(self.notificationHubService.hubName + '/registrations/' + registrationId)
        .withHeader(HeaderConstants.CONTENT_TYPE, 'application/atom+xml;type=entry;charset=utf-8')
        .withHeader(HeaderConstants.CONTENT_LENGTH, Buffer.byteLength(registrationXml, 'utf8'));

      if (options &amp;&amp; options.etag) {
        webResource.withHeader(HeaderConstants.IF_MATCH, options.etag);
      } else {
        webResource.withHeader(HeaderConstants.IF_MATCH, '*');
      }

      self.notificationHubService._executeRequest(webResource, registrationXml, registrationResult, null, callback);
    };

    var createOrUpdateRegistrationName = util.format('createOrUpdate%sRegistration', templateName);
    self[createOrUpdateRegistrationName] = function () {
      var registrationId = Array.prototype.shift.apply(arguments);
      var callback = arguments[arguments.length - 1];

      if (!_.isFunction(callback)) {
        throw new Error('The callback parameter must be the callback function.');
      }

      var options = {};
      if (arguments.length >= 3 &amp;&amp; _.isObject(arguments[arguments.length - 2])) {
        options = arguments[arguments.length - 2];
      }

      var registrationXml = createRegistrationXml(arguments);

      var webResource = WebResource.put(self.notificationHubService.hubName + '/registrations/' + registrationId)
        .withHeader(HeaderConstants.CONTENT_TYPE, 'application/atom+xml;type=entry;charset=utf-8')
        .withHeader(HeaderConstants.CONTENT_LENGTH, Buffer.byteLength(registrationXml, 'utf8'));

      self.notificationHubService._executeRequest(webResource, registrationXml, registrationResult, null, callback);
    };
  };

  templateSpecs.forEach(function (templateName) {
    var createName = util.format('create%s', templateName);

    if (_.isFunction(mpns[createName])) {
      // Expose create methods to be able to send raw payloads
      self[createName] = mpns[createName];

      // Expose send methods as convenience
      addSendMethod(createName, templateName);

      // Expose create registration methods
      addCreateAndUpdateRegistrationMethod(createName, templateName);
    }
  });
}

/**
* Creates a native MPNS registration.
*
* @param {string}                     channel                     The device channel uri.
* @param {string|array}               tags                        The tags (comma-separated list, no spaces).
* @param {object}                     [options]                   The request options.
* @param {Function(error, response)}  callback                    The callback function.
* @return {undefined}
*/
MpnsService.prototype.createNativeRegistration = function (channel, tags, optionsOrCallback, callback) {
  var options;
  azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { options = o; callback = c; });

  validate.validateArgs('createNativeRegistration', function (v) {
    v.string(channel, 'channel');
    v.callback(callback);
  });

  var registrationXml = this._createBody('MpnsRegistrationDescription', channel, tags, null, options);

  var webResource = WebResource.post(this.notificationHubService.hubName + '/registrations')
    .withHeader(HeaderConstants.CONTENT_TYPE, 'application/atom+xml;type=entry;charset=utf-8')
    .withHeader(HeaderConstants.CONTENT_LENGTH, Buffer.byteLength(registrationXml, 'utf8'));

  this.notificationHubService._executeRequest(webResource, registrationXml, registrationResult, null, callback);
};

/**
* Creates or updates a native MPNS registration.
*
* @param {string}                     registrationId      The registration identifier.
* @param {string}                     channel             The device channel uri.
* @param {string|array}               tags                The tags (comma-separated list, no spaces).
* @param {object}                     [options]           The request options.
* @param {Function(error, response)}  callback            The callback function.
* @return {undefined}
*/
MpnsService.prototype.createOrUpdateNativeRegistration = function (registrationId, channel, tags, optionsOrCallback, callback) {
  var options;
  azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { options = o; callback = c; });

  validate.validateArgs('createOrUpdateNativeRegistration', function (v) {
    v.string(registrationId, 'registrationId');
    v.string(channel, 'channel');
    v.callback(callback);
  });

  var registrationXml = this._createBody('MpnsRegistrationDescription', channel, tags, null, options);

  var webResource = WebResource.put(this.notificationHubService.hubName + '/registrations/' + registrationId)
    .withHeader(HeaderConstants.CONTENT_TYPE, 'application/atom+xml;type=entry;charset=utf-8')
    .withHeader(HeaderConstants.CONTENT_LENGTH, Buffer.byteLength(registrationXml, 'utf8'));

  this.notificationHubService._executeRequest(webResource, registrationXml, registrationResult, null, callback);
};

/**
* @name MpnsService#createFlipTileRegistration
* @function
*
* @description
* Creates a registration with a FlipTile template (Only Windows Phone version 7.8 or later). For more information see http://msdn.microsoft.com/en-us/library/windowsazure/jj206971.aspx.
*
* @param {string}                     channel                           The ChannelUri.
* @param {string|array}               tags                              The tags (comma-separated list, no spaces).
* @param {object}                     template                          The registration template.
* @param {string}                     template.backgroundImage          The URI of the background image for the tile.
* @param {string}                     template.count                    The number that appears on the tile.
* @param {string}                     template.title                    The title text of the tile.
* @param {string}                     template.backBackgroundImage      The URI of the image that is shown on the backside of the tile.
* @param {string}                     template.backTitle                Title for the backside side of the tile.
* @param {string}                     template.backContent              Text for the backside of the tile.
* @param {string}                     template.id                       ID of a related, secondary tile.
* @param {string}                     template.smallBackgroundImage     The URI for the background image for the tile when it is reduced to its small size.
* @param {string}                     template.wideBackgroundImage      The URI for the background image for the tile when it is expanded to its wide size.
* @param {string}                     template.wideBackContent          Content for the back tile when the tile is expanded to its wide size.
* @param {string}                     template.wideBackBackgroundImage  The URI for the image to be on the backside of the tile when the tile is expanded to its wide size.
* @param {object}                     [options]                         The request options.
* @param {object}                     [options.headers]                 The mpns headers.
* @param {Function(error, response)}  callback                          The callback function.
* @return {undefined}
*/

/**
* @name MpnsService#createTileRegistration
* @function
*
* @description
* Creates a registration with a Tile template. For more information see http://msdn.microsoft.com/en-us/library/windowsazure/jj553779.aspx.
*
* @param {string}                     channel                        The ChannelUri.
* @param {string|array}               tags                           The tags (comma-separated list, no spaces).
* @param {object}                     template                       The registration template.
* @param {string}                     template.backgroundImage       The URI of the background image for the tile.
* @param {string}                     template.count                 The number that appears on the tile.
* @param {string}                     template.title                 The title text of the tile.
* @param {string}                     template.backBackgroundImage   The URI of the image that is shown on the backside of the tile.
* @param {string}                     template.backTitle             Title for the backside side of the tile.
* @param {string}                     template.backContent           Text for the backside of the tile.
* @param {string}                     template.id                    ID of a related, secondary tile.
* @param {object}                     [options]                      The request options.
* @param {object}                     [options.headers]              The mpns headers.
* @param {Function(error, response)}  callback                       The callback function.
* @return {undefined}
*/

/**
* @name MpnsService#createToastRegistration
* @function
*
* @description
* Creates a registration with a Toast template For more information see http://msdn.microsoft.com/en-us/library/windowsazure/jj553779.aspx.
*
* @param {string}                     channel                        The ChannelUri.
* @param {string|array}               tags                           The tags (comma-separated list, no spaces).
* @param {object}                     template                       The registration template.
* @param {string}                     template.text1                 Text1
* @param {string}                     template.text2                 Text2
* @param {string}                     template.param                 (optional) (Only for Windows Phone version 7.5 or later)

* @param {object}                     [options]                      The request options.
* @param {object}                     [options.headers]              The mpns headers.
* @param {Function(error, response)}  callback                       The callback function.
* @return {undefined}
*/

/**
* Creates a raw template registration.
*
* @param {string}                     channel                                The device channel uri.
* @param {string|array}               tags                                   The tags (comma-separated list, no spaces).
* @param {json}                       template                               The template for the registration.
* @param {object}                     [options]                              The request options.
* @param {object}                     [options.headers]                      The mpns headers to include.
* @param {Function(error, response)}  callback                               The callback function.
* @return {undefined}
*/
MpnsService.prototype.createRawTemplateRegistration = function (channel, tags, template, optionsOrCallback, callback) {
  var options;
  azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { options = o; callback = c; });

  validate.validateArgs('createRawTemplateRegistration', function (v) {
    v.string(channel, 'channel');
    v.callback(callback);
  });

  var registrationXml = this._createTemplateBody(channel, tags, template, options);

  var webResource = WebResource.post(this.notificationHubService.hubName + '/registrations')
    .withHeader(HeaderConstants.CONTENT_TYPE, 'application/atom+xml;type=entry;charset=utf-8')
    .withHeader(HeaderConstants.CONTENT_LENGTH, Buffer.byteLength(registrationXml, 'utf8'));

  this.notificationHubService._executeRequest(webResource, registrationXml, registrationResult, null, callback);
};

/**
* Creates a raw template registration.
*
* @param {string}                     registrationId      The registration identifier.
* @param {string}                     channel             The device channel uri.
* @param {string|array}               tags                The tags (comma-separated list, no spaces).
* @param {json}                       template            The template for the registration.
* @param {object}                     [options]           The request options.
* @param {object}                     [options.headers]   The mpns headers to include.
* @param {Function(error, response)}  callback            The callback function.
* @return {undefined}
*/
MpnsService.prototype.createOrUpdateRawTemplateRegistration = function (registrationId, channel, tags, template, optionsOrCallback, callback) {
  var options;
  azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { options = o; callback = c; });

  validate.validateArgs('createOrUpdateRawTemplateRegistration', function (v) {
    v.string(registrationId, 'registrationId');
    v.string(channel, 'channel');
    v.callback(callback);
  });

  var registrationXml = this._createTemplateBody(channel, tags, template, options);

  var webResource = WebResource.put(this.notificationHubService.hubName + '/registrations/' + registrationId)
    .withHeader(HeaderConstants.CONTENT_TYPE, 'application/atom+xml;type=entry;charset=utf-8')
    .withHeader(HeaderConstants.CONTENT_LENGTH, Buffer.byteLength(registrationXml, 'utf8'));

  this.notificationHubService._executeRequest(webResource, registrationXml, registrationResult, null, callback);
};

/**
* @name MpnsService#updateFlipTileRegistration
* @function
*
* @description
* Updates a registration with a FlipTile template (Only Windows Phone version 7.8 or later). For more information see http://msdn.microsoft.com/en-us/library/windowsazure/jj206971.aspx.
*
* @param {string}                     registrationId                    The registration identifier.
* @param {string}                     channel                           The ChannelUri.
* @param {string|array}               tags                              The tags (comma-separated list, no spaces).
* @param {object}                     template                          The registration template.
* @param {string}                     template.backgroundImage          The URI of the background image for the tile.
* @param {string}                     template.count                    The number that appears on the tile.
* @param {string}                     template.title                    The title text of the tile.
* @param {string}                     template.backBackgroundImage      The URI of the image that is shown on the backside of the tile.
* @param {string}                     template.backTitle                Title for the backside side of the tile.
* @param {string}                     template.backContent              Text for the backside of the tile.
* @param {string}                     template.id                       ID of a related, secondary tile.
* @param {string}                     template.smallBackgroundImage     The URI for the background image for the tile when it is reduced to its small size.
* @param {string}                     template.wideBackgroundImage      The URI for the background image for the tile when it is expanded to its wide size.
* @param {string}                     template.wideBackContent          Content for the back tile when the tile is expanded to its wide size.
* @param {string}                     template.wideBackBackgroundImage  The URI for the image to be on the backside of the tile when the tile is expanded to its wide size.
* @param {object}                     [options]                         The request options.
* @param {object}                     [options.headers]                 The mpns headers.
* @param {Function(error, response)}  callback                          The callback function.

* @return {undefined}
*/

/**
* @name MpnsService#updateTileRegistration
* @function
*
* @description
* Updates a registration with a Tile template. For more information see http://msdn.microsoft.com/en-us/library/windowsazure/jj553779.aspx.
*
&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD
* @param {string}                     registrationId                 The registration identifier.
* @param {string}                     channel                        The ChannelUri.
* @param {string|array}               tags                           The tags (comma-separated list, no spaces).
* @param {object}                     template                       The registration template.
* @param {string}                     template.backgroundImage       The URI of the background image for the tile.
* @param {string}                     template.count                 The number that appears on the tile.
* @param {string}                     template.title                 The title text of the tile.
* @param {string}                     template.backBackgroundImage   The URI of the image that is shown on the backside of the tile.
* @param {string}                     template.backTitle             Title for the backside side of the tile.
* @param {string}                     template.backContent           Text for the backside of the tile.
* @param {string}                     template.id                    ID of a related, secondary tile.
* @param {object}                     [options]                      The request options.
* @param {object}                     [options.headers]              The mpns headers.
* @param {Function(error, response)}  callback                       The callback function.
* @return {undefined}
*/

/**
* @name MpnsService#updatesToastRegistration
* @function
*
* @description
* Updates a registration with a Toast template. For more information see http://msdn.microsoft.com/en-us/library/windowsazure/jj553779.aspx.
*
* @param {string}                     registrationId                 The registration identifier.
* @param {string}                     channel                        The ChannelUri.
* @param {string|array}               tags                           The tags (comma-separated list, no spaces).
* @param {object}                     template                       The registration template.
* @param {string}                     template.text1                 Text1
* @param {string}                     template.text2                 Text2
* @param {string}                     template.param                 (optional) (Only for Windows Phone version 7.5 or later)
* @param {object}                     [options]                      The request options.
* @param {object}                     [options.headers]              The mpns headers.
* @param {Function(error, response)}  callback                       The callback function.
* @return {undefined}
*/

/**
* Updates a raw template registration.
*
* @param {string}                     registrationId                         The registration identifier.
* @param {string}                     channel                                The ChannelUri.
* @param {string|array}               tags                                   The tags (comma-separated list, no spaces).
* @param {json}                       template                               The template for the registration.
* @param {object}                     [options]                              The request options.
* @param {object}                     [options.headers]                      The mpns headers to include.
* @param {object}                     [options.etag]                         The etag to include.
* @param {Function(error, response)}  callback                               The callback function.
* @return {undefined}
*/
MpnsService.prototype.updatesRawTemplateRegistration = function (registrationId, channel, tags, template, optionsOrCallback, callback) {
  var options;
  azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { options = o; callback = c; });

  validate.validateArgs('updatesRawTemplateRegistration', function (v) {
    v.string(registrationId, 'registrationId');
    v.string(channel, 'channel');
    v.callback(callback);
  });

  var registrationXml = this._createTemplateBody(channel, tags, template, options);

  var webResource = WebResource.put(this.notificationHubService.hubName + '/registrations/' + registrationId)
    .withHeader(HeaderConstants.CONTENT_TYPE, 'application/atom+xml;type=entry;charset=utf-8')
    .withHeader(HeaderConstants.CONTENT_LENGTH, Buffer.byteLength(registrationXml, 'utf8'));

  if (options &amp;&amp; options.etag) {
    webResource.withHeader(HeaderConstants.IF_MATCH, options.etag);
  } else {
    webResource.withHeader(HeaderConstants.IF_MATCH, '*');
  }

  this.notificationHubService._executeRequest(webResource, registrationXml, registrationResult, null, callback);
};

/**
* Retrieves a registration by channel.
*
* @param {string}                     channel                   The ChannelUri.
* @param {object}                     [options]                 The request options. Additional properties will be passed as headers.
* @param {object}                     [options.top]             Specifies the maximum number of registration to obtain from the call.
* @param {object}                     [options.skip]            Specifies the number of registrations to skip in the call.
* @param {Function(error, response)}  callback                  The callback function.
* @return {undefined}
*/
MpnsService.prototype.listRegistrationsByChannel = function (channel, optionsOrCallback, callback) {
  var options;
  azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { options = o; callback = c; });

  validate.validateArgs('listRegistrationsByChannel', function (v) {
    v.string(channel, 'channel');
    v.callback(callback);
  });

  var webResource = WebResource.get(this.notificationHubService.hubName + '/registrations/')
    .withQueryOption('$filter', 'ChannelUri eq \'' + channel + '\'');

  if (options) {
    if (options.top) {
      webResource.withQueryOption('$top', options.top);
    }

    if (options.skip) {
      webResource.withQueryOption('$skip', options.skip);
    }
  }

  this.notificationHubService._executeRequest(webResource, null, registrationResult, null, callback);
};

/**
* @name MpnsService#sendFlipTile
* @function
*
* @description
* Sends a FlipTile notification (Only Windows Phone version 7.8 or later). For more information see http://msdn.microsoft.com/en-us/library/windowsazure/jj206971.aspx.
*
* @param {string}                     tags                            A single tag or tag expression.
* @param {object}                     payload                         The message's payload.
* @param {string}                     payload.backgroundImage         The URI of the background image for the tile.
* @param {string}                     payload.count                   The number that appears on the tile.
* @param {string}                     payload.title                   The title text of the tile.
* @param {string}                     payload.backBackgroundImage     The URI of the image that is shown on the backside of the tile.
* @param {string}                     payload.backTitle               Title for the backside side of the tile.
* @param {string}                     payload.backContent             Text for the backside of the tile.
* @param {string}                     payload.id                      ID of a related, secondary tile.
* @param {string}                     payload.smallBackgroundImage    The URI for the background image for the tile when it is reduced to its small size.
* @param {string}                     payload.wideBackgroundImage     The URI for the background image for the tile when it is expanded to its wide size.
* @param {string}                     payload.wideBackContent         Content for the back tile when the tile is expanded to its wide size.
* @param {string}                     payload.wideBackBackgroundImage The URI for the image to be on the backside of the tile when the tile is expanded to its wide size.
* @param {object}                     [options]                       The request options.
* @param {object}                     [options.headers]               The mpns headers.
* @param {Function(error, response)}  callback                        The callback function.
* @return {undefined}
*/

/**
* @name MpnsService#sendTile
* @function
*
* @description
* Sends a Tile notification. For more information see http://msdn.microsoft.com/en-us/library/windowsazure/jj553779.aspx.
*
* @param {string}                     tags                           A single tag or tag expression.
* @param {object}                     payload                        The message's payload.
* @param {string}                     payload.backgroundImage        The URI of the background image for the tile.
* @param {string}                     payload.count                  the number that appears on the tile.
* @param {string}                     payload.title                  the title text of the tile.
* @param {string}                     payload.backBackgroundImage    The URI of the image that is shown on the backside of the tile.
* @param {string}                     payload.backTitle              Title for the backside side of the tile.
* @param {string}                     payload.backContent            Text for the backside of the tile.
* @param {string}                     payload.id                     ID of a related, secondary tile.
* @param {object}                     [options]                      The request options.
* @param {object}                     [options.headers]              The mpns headers.
* @param {Function(error, response)}  callback                       The callback function.
* @return {undefined}
*/

/**
* @name MpnsService#sendToast
* @function
*
* @description
* Sends a Toast notification. For more information see http://msdn.microsoft.com/en-us/library/windowsazure/jj553779.aspx.
*
* @param {string}                     tags                           A single tag or tag expression.
* @param {object}                     payload                        The message's payload.
* @param {string}                     payload.text1                  Text1
* @param {string}                     payload.text2                  Text2
* @param {string}                     payload.param                  (optional) (Only for Windows Phone version 7.5 or later)
* @param {object}                     [options]                      The request options.
* @param {object}                     [options.headers]              The mpns headers.
* @param {Function(error, response)}  callback                       The callback function.
* @return {undefined}
*/

/**
* Sends a custom MPNS notification. Use this method if you want to have full control on the payload.
*
* @param {string}                     tags                           A single tag or tag expression.
* @param {string}                     payload                        The message's XML payload.
* @param {string}                     targetName                     The target name.
* @param {string}                     notificationClass              The notification class.
* @param {object}                     [options]                      The request options.
* @param {object}                     [options.headers]              The mpns headers.
* @param {Function(error, response)}  callback                       The callback function.
* @return {undefined}
*/
MpnsService.prototype.send = function (tags, payload, targetName, notificationClass, optionsOrCallback, callback) {
  var options;
  azureutil.normalizeArgs(optionsOrCallback, callback, function (o, c) { options = o; callback = c; });

  if (!_.isString(payload)) {
    throw new Error('The payload parameter must be the notification payload string.');
  }

  if (!_.isFunction(callback)) {
    throw new Error('The callback parameter must be the callback function.');
  }

  var headers = {};
  headers[HeaderConstants.SERVICE_BUS_NOTIFICATION_FORMAT] = 'windowsphone';

  if (tags) {
    if (_.isArray(tags)) {
      tags = this.notificationHubService._joinTagsSend(tags);
    }

    headers[HeaderConstants.SERVICE_BUS_NOTIFICATION_TAGS] = tags;
  }

  headers['X-WindowsPhone-Target'] = targetName;
  headers['X-NotificationClass'] = notificationClass;

  if (options &amp;&amp; options.headers) {
    Object.keys(options.headers).forEach(function (header) {
      headers[header] = options.headers[header];
    });
  }

  this.notificationHubService._sendNotification(payload, headers, callback);
};

/**
* Creates a template registration body.
* @ignore
*
* @param {string}             elementName                  The element name.
* @param {string}             channel                      The device channel uri.
* @param {string|array}       tags                         The tags.
* @param {json}               template                     The template for the registration.
* @param {object}             [options]                    The request options.
* @param {object}             [options.pnsCredentialName]  The pns credentials to use.
* @param {object}             [options.headers]            The mpns headers to include.
* @return {undefined}
*/
MpnsService.prototype._createBody = function (elementName, channel, tags, template, options) {
  var registration = { };

  if (options) {
    if (options.registrationId) {
      registration['RegistrationId'] = options.registrationId;
    }

    if (options.pnsCredentialName) {
      registration['PnsCredentialName'] = options.pnsCredentialName;
    }
  }

  if (tags) {
    if (_.isArray(tags)) {
      tags = this.notificationHubService._joinTags(tags);
    }

    registration.Tags = tags;
  }

  registration.ChannelUri = channel;

  if (template) {
    registration.BodyTemplate = '&lt;![CDATA[' + template + ']]>';
  }

  if (options) {
    if (options.headers) {
      registration.MpnsHeaders = { MpnsHeader: [] };
      Object.keys(options.headers).forEach(function (headerName) {
        registration.MpnsHeaders.MpnsHeader.push({ Header: headerName, Value: options.headers[headerName] });
      });
    }
  }

  var registrationXml;
  if (options &amp;&amp; options.registrationId) {
    registrationXml = registrationResult.serialize(elementName, registration, {
      title: options.registrationId
    });
  } else {
    registrationXml = registrationResult.serialize(elementName, registration);
  }

  return registrationXml;
};

/**
* Creates a template registration body.
* @ignore
*
* @param {string}             channel                      The device channel uri.
* @param {string|array}       tags                         The tags.
* @param {json}               template                     The template for the registration.
* @param {object}             [options]                    The request options.
* @param {object}             [options.pnsCredentialName]  The pns credentials to use.
* @param {object}             [options.headers]            The mpns headers to include.
* @return {undefined}
*/
MpnsService.prototype._createTemplateBody = function (channel, tags, template, options) {
  return this._createBody('MpnsTemplateRegistrationDescription', channel, tags, template, options);
};

module.exports = MpnsService;</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Mon Apr 03 2017 13:40:58 GMT-0700 (PDT) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="../../scripts/linenumber.js"></script>
</body>
</html>
